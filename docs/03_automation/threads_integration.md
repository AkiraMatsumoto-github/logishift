# Threads連携ガイド

現在の自動投稿システムにThreadsへの投稿機能を追加するための、アカウント作成、API設定、および実装方針のまとめです。

## 1. アカウントとAPI利用の準備

Threads APIを利用するには、**Meta Developer Account**と**Instagram(Threads)アカウント**の連携が必要です。

### 手順
1.  **Meta Developer Accountの作成**
    *   Facebookアカウントが必要です。[Meta for Developers](https://developers.facebook.com/) にアクセスし、登録します。
2.  **アプリの作成**
    *   マイアプリ > 「アプリを作成」を選択。
    *   ユースケースとして「**Threads APIへのアクセス**」を選択 (または「その他」>「次へ」>「ビジネス」など、UIの変更に合わせて適切なものを選択)。
    *   アプリ名を入力し、作成完了。
3.  **Threads製品の追加と設定**
    *   アプリのダッシュボードで、「Threads」製品を探して「設定」をクリック。
    *   **ユーザー認証**: OAuth設定を行うため、リダイレクトURLを設定する必要があります（個人の自動化用なら `https://localhost` や `http://localhost:8000` などでも可）。
4.  **テストユーザーの追加**
    *   アプリが「開発モード」の間は、APIを利用できるのは追加されたテスターのみです。
    *   「アプリのロール」>「ロール」>「テスター」に、あなたのInstagram(Threads)アカウントを追加します。
    *   **重要**: Threadsアプリ(またはWeb)の設定 > 「アカウント」 > 「Webサイトの許可」 > 「テスターの招待」から、招待を承認する必要があります。

## 2. APIキー (アクセストークン) の取得方法

Threads APIは固定の「API Key」ではなく、**OAuthアクセストークン**を使用します。
トークンには有効期限があるため、「長期トークン (60日間有効)」を取得し、定期的にリフレッシュする仕組みが推奨されます。

### 簡易取得フロー (個人利用向け)
1.  **認証コードの取得**: ブラウザで以下のURLにアクセスし、承認します。
    ```
    https://threads.net/oauth/authorize
    ?client_id=<APP_ID>
    &redirect_uri=<REDIRECT_URI>
    &scope=threads_basic,threads_content_publish
    &response_type=code
    ```
2.  **短期トークンの取得**: リダイレクトされたURLに含まれる `code` を使い、`POST` リクエストでトークンを取得します。
3.  **長期トークンへの交換**: 取得した短期トークンを、長期トークン交換用エンドポイントに送信して交換します。

※ 実装時には、このフローを補助するスクリプト (`auth_threads.py` 等) を作成するとスムーズです。

## 3. 投稿テキストの仕様とX(Twitter)との比較

X(Twitter)向けのテキスト生成ロジックは、基本的にThreadsでも流用可能です。

| 項目 | X (Free/Basic) | Threads API | 判定 |
| :--- | :--- | :--- | :--- |
| **文字数制限** | 280文字 (全角140文字) | **500文字** | Threadsの方が余裕があります。X用に短くしているなら問題ありません。 |
| **URLの扱い** | 文字数にカウントされる (23文字分) | 文字数にカウントされる | 同様です。 |
| **リンクカード** | 自動生成 | **自動生成** | テキスト内の最初のURLがカード化されます。 |
| **画像添付** | 最大4枚 | カルーセル投稿が可能 | 実装により可能です(今回はテキスト+リンク主体と想定)。 |
| **ハッシュタグ** | `#タグ` で機能 | `#タグ` で機能 (タグ化機能あり) | そのまま流用可能です。 |

### 結論: Xと同じ文言でOK？
**はい、基本的には同じ文言で問題ありません。**
Threadsの方が文字数制限が緩いため、X用に最適化されたテキストはそのまま投稿できます。
将来的には、Threads専用に少し長めの解説を加えるなどの差別化も可能です。

## 4. 今後の実装方針 (提案)

現在の `sns_client.py` を拡張し、Threads対応を行うことを推奨します。

1.  **`ThreadsClient` クラスの実装** (`automation/threads_client.py`)
    *   トークン管理と投稿機能 (`POST /me/threads` -> `POST /media/publish`) をカプセル化。
2.  **`SNSClient` の改修**
    *   Xへの投稿と並行して、Threadsへも投稿するように `generate_article.py` から呼び出し。
3.  **環境変数 (`.env`) の追加**
    *   `THREADS_APP_ID`
    *   `THREADS_APP_SECRET`
    *   `THREADS_USER_ID`
    *   `THREADS_ACCESS_TOKEN`

まずは、**「APIのセットアップ（アプリ作成とトークン取得）」** をユーザー様の方で行っていただく必要があります。
サポート用の認証スクリプトが必要であれば作成しますので、お知らせください。
